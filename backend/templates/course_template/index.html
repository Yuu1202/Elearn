<!DOCTYPE html>
<html lang="en">
<head>
  <!-- Konfigurasi Dasar HTML -->
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{{COURSE_TITLE}}</title>
  
  <style>
/* --- style.css content starts --- */
/*
 * Bagian CSS: Menentukan tampilan visual halaman (Gaya Desain).
 *
 * Catatan: Dalam file ini, CSS diletakkan langsung di dalam tag <style>
 * agar aplikasi bisa berjalan dalam satu file.
 */
body {
  font-family: Arial, sans-serif;
  line-height: 1.6;
  margin: 0;
  padding: 20px;
  background-color: #f4f4f9; /* Latar belakang abu-abu muda */
}

header {
  background: #333; /* Latar belakang header hitam */
  color: white;
  padding: 10px 20px;
  margin-bottom: 20px;
  display: flex;
  justify-content: space-between; /* Menata judul dan progres di ujung yang berlawanan */
  align-items: center;
}

h1, h2 {
  color: #333;
}

/* Styling untuk setiap bagian materi kursus dan kuis */
.course-section, .course-quiz {
  background: white;
  padding: 20px;
  border-radius: 8px; /* Sudut membulat */
  box-shadow: 0 2px 4px rgba(0,0,0,0.1); /* Efek bayangan */
  margin-bottom: 20px;
}

/* Styling tombol 'Selesai' */
.complete-btn {
  background: #007bff; /* Warna biru utama */
  color: white;
  border: none;
  padding: 10px 15px;
  border-radius: 5px;
  cursor: pointer;
  margin-top: 10px;
}

.complete-btn:hover {
  background: #0056b3; /* Sedikit lebih gelap saat disentuh */
}

.completed {
  color: green; /* Warna hijau untuk status selesai */
  font-weight: bold;
  margin-left: 10px;
}

.incomplete {
  color: orange; /* Warna oranye untuk status belum selesai */
  font-weight: bold;
  margin-left: 10px;
}

#quiz-result {
  margin-top: 15px;
  padding: 10px;
  border: 1px solid #ddd;
}
/* --- style.css content ends --- */
  </style>
</head>
<body>

  <header>
    <!-- Judul Kursus -->
    <h1>{{COURSE_TITLE}}</h1>
    <!-- Tempat untuk menampilkan status progres pengguna -->
    <div id="progress-display">Progress: 0%</div>
  </header>

  <main>
    <!-- Section 1: Konten Kursus -->
    <section id="section_1" class="course-section">
      <h2>1. Pengenalan</h2>
      <p>Ini adalah konten pertama Anda. Jelaskan dasar-dasar topik di sini.</p>
      <!-- Tombol yang memanggil fungsi JavaScript saat diklik -->
      <button onclick="markComplete('section_1')" class="complete-btn">Tandai Selesai: Section 1</button>
      <!-- Area untuk menampilkan status penyelesaian section -->
      <span class="status" id="status_section_1"></span>
    </section>
    
    <!-- Section 2: Konten Kursus -->
    <section id="section_2" class="course-section">
      <h2>2. Konsep Inti</h2>
      <p>Selami topik utama. Sertakan kode, gambar, atau contoh di sini.</p>
      <button onclick="markComplete('section_2')" class="complete-btn">Tandai Selesai: Section 2</button>
      <span class="status" id="status_section_2"></span>
    </section>

    <!-- Section 3: Konten Kursus -->
    <section id="section_3" class="course-section">
      <h2>3. Topik Lanjutan</h2>
      <p>Sediakan materi tambahan atau tips lanjutan untuk memperkaya pengetahuan siswa.</p>
      <button onclick="markComplete('section_3')" class="complete-btn">Tandai Selesai: Section 3</button>
      <span class="status" id="status_section_3"></span>
    </section>

    <!-- Quiz Section -->
    <section id="quiz_1" class="course-quiz">
      <h2>Quiz Akhir</h2>
      <div id="question-container">
        <p>1. Apa hasil dari 2 + 2?</p>
        <!-- Pilihan jawaban (Radio Buttons) -->
        <input type="radio" name="q1" value="3"> 3<br>
        <input type="radio" name="q1" value="4"> 4<br>
        <input type="radio" name="q1" value="5"> 5<br>
        <!-- Tombol untuk mengirimkan quiz -->
        <button onclick="submitCourseQuiz()">Kirim Jawaban</button>
      </div>
      <!-- Area untuk menampilkan hasil quiz setelah dikirim -->
      <div id="quiz-result"></div>
    </section>
  </main>

  <script>
    // Metadata Kursus (Variabel Konstanta)
    const COURSE_ID = '{{COURSE_ID}}'; // ID unik kursus saat ini
    const COURSE_SECTIONS = ['section_1', 'section_2', 'section_3']; // Daftar ID semua section
    const COURSE_QUIZZES = ['quiz_1']; // Daftar ID semua quiz
    
    // Kunci Jawaban Quiz
    const QUIZ_ANSWERS = {
      'q1': '4'
    };
    
/* --- script.js content starts --- */
//
// Bagian JavaScript: Mengelola logika interaksi, API, dan progres pengguna.
//

// Konfigurasi API Back-end
const API_URL = 'http://localhost:5000/api'; // URL dasar untuk endpoint API
const TOKEN = localStorage.getItem('token'); // Mengambil token otentikasi dari penyimpanan lokal

// Objek courseAPI: Berisi fungsi-fungsi untuk berinteraksi dengan back-end
const courseAPI = {
  // Fungsi untuk menandai sebuah section telah selesai
  async markSectionComplete(sectionId) {
    if (!TOKEN) {
      alert('Silakan login untuk melacak progres'); // Notifikasi jika pengguna belum login
      return;
    }
    
    try {
      // Melakukan Panggilan API (PUT request) untuk update progres
      const response = await fetch(`${API_URL}/progress/section`, {
        method: 'PUT',
        headers: {
          'Authorization': `Bearer ${TOKEN}`, // Menyertakan token otentikasi
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({ 
          courseId: COURSE_ID, 
          sectionId 
        })
      });
      
      const data = await response.json();
      
      // Jika pengguna mendapatkan lencana (badge), tampilkan notifikasi
      if (data.badgeEarned) {
        alert(`üéâ Lencana Diperoleh: ${data.badgeEarned.badgeName}`);
      }
      
      console.log('Section completed:', data);
      await updateProgressDisplay(); // Memperbarui tampilan progres di halaman
      return data;
    } catch (error) {
      console.error('Error marking section:', error);
    }
  },
  
  // Fungsi untuk mengirimkan hasil quiz
  async submitQuiz(quizId, score) {
    if (!TOKEN) {
      alert('Silakan login untuk menyimpan hasil kuis');
      return;
    }
    
    try {
      // Melakukan Panggilan API (POST request) untuk mengirim skor quiz
      const response = await fetch(`${API_URL}/progress/quiz`, {
        method: 'POST',
        headers: {
          'Authorization': `Bearer ${TOKEN}`,
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          courseId: COURSE_ID,
          quizId,
          score
        })
      });
      
      const data = await response.json();
      
      if (data.badgeEarned) {
        alert(`üéâ Lencana Diperoleh: ${data.badgeEarned.badgeName}`);
      }
      
      await updateProgressDisplay(); // Memperbarui tampilan progres
      return data;
    } catch (error) {
      console.error('Error submitting quiz:', error);
    }
  },
  
  // Fungsi untuk mendapatkan data progres pengguna saat ini
  async getProgress() {
    if (!TOKEN) return null;
    
    try {
      // Melakukan Panggilan API (GET request) untuk mengambil progres
      const response = await fetch(`${API_URL}/progress/course/${COURSE_ID}`, {
        headers: {
          'Authorization': `Bearer ${TOKEN}`
        }
      });
      
      if (response.ok) {
        return await response.json();
      }
      return null;
    } catch (error) {
      console.error('Error getting progress:', error);
      return null;
    }
  }
};

/**
 * Logika Course Client (Fungsi Interaksi UI)
 */

// Menghitung skor quiz berdasarkan jawaban pengguna
function calculateQuizScore() {
  let score = 0;
  
  // Mengambil jawaban yang dicentang oleh pengguna
  const q1_answer = document.querySelector('input[name="q1"]:checked')?.value;

  // Membandingkan dengan kunci jawaban
  if (q1_answer === QUIZ_ANSWERS['q1']) {
    score += 1; // Menambah skor jika jawaban benar
  }
  
  return score;
}

// Handler utama saat tombol 'Tandai Selesai' diklik
async function markComplete(sectionId) {
  const result = await courseAPI.markSectionComplete(sectionId); // Panggil API untuk menandai selesai
  
  // Update UI secara lokal setelah sukses
  if (result) {
    document.getElementById(`status_${sectionId}`).textContent = '‚úÖ Selesai';
    document.getElementById(`status_${sectionId}`).classList.add('completed');
  }
}

// Handler utama saat tombol 'Kirim Jawaban Quiz' diklik
async function submitCourseQuiz() {
  const score = calculateQuizScore(); // Hitung skor quiz
  const quizId = COURSE_QUIZZES[0];
  
  const result = await courseAPI.submitQuiz(quizId, score); // Panggil API untuk mengirim skor
  const resultDiv = document.getElementById('quiz-result');

  // Tampilkan hasil quiz di UI
  if (result) {
    resultDiv.innerHTML = `<strong>Hasil Anda: ${score} dari 1.</strong><br>`;
    if (result.isCompleted) {
      resultDiv.innerHTML += 'Kuis ini sudah selesai dan tersimpan.';
    } else {
      resultDiv.innerHTML += 'Gagal menyimpan hasil kuis.';
    }
  } else {
    resultDiv.innerHTML = 'Gagal mengirim hasil kuis.';
  }
}

// Fungsi utama untuk memperbarui seluruh tampilan progres di halaman
async function updateProgressDisplay() {
  const progress = await courseAPI.getProgress(); // Ambil progres terbaru dari API
  const display = document.getElementById('progress-display');
  
  if (!progress) {
    display.textContent = 'Progres: Login diperlukan';
    return;
  }
  
  // Perhitungan Progres
  const totalItems = COURSE_SECTIONS.length + COURSE_QUIZZES.length; 
  const sectionsDone = progress.completedSections.filter(s => COURSE_SECTIONS.includes(s)).length;
  const quizzesDone = progress.completedQuizzes.filter(q => COURSE_QUIZZES.includes(q)).length;
  const itemsDone = sectionsDone + quizzesDone;
  
  const percentage = totalItems > 0 ? Math.round((itemsDone / totalItems) * 100) : 0;
  
  // Tampilkan persentase progres
  display.textContent = `Progres: ${percentage}% (${itemsDone}/${totalItems} item)`;
  
  // Update status visual untuk setiap section
  COURSE_SECTIONS.forEach(sectionId => {
    const statusEl = document.getElementById(`status_${sectionId}`);
    if (statusEl) {
      if (progress.completedSections.includes(sectionId)) {
        statusEl.textContent = '‚úÖ Selesai';
        statusEl.classList.add('completed');
        statusEl.classList.remove('incomplete');
      } else {
        statusEl.textContent = '‚è≥ Belum Selesai';
        statusEl.classList.add('incomplete');
        statusEl.classList.remove('completed');
      }
    }
  });

  // Update status Quiz
  const quizResultDiv = document.getElementById('quiz-result');
  const quizId = COURSE_QUIZZES[0];
  if (progress.completedQuizzes.includes(quizId)) {
    quizResultDiv.innerHTML = '<strong>Kuis ini sudah selesai dan tersimpan di riwayat Anda.</strong>';
  }
}

// Event Listener: Panggil updateProgressDisplay saat halaman selesai dimuat (Inisialisasi)
document.addEventListener('DOMContentLoaded', updateProgressDisplay);
/* --- script.js content ends --- */
  </script>
</body>
</html>
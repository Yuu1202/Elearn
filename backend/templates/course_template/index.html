<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{{COURSE_TITLE}}</title>
  
  <style>
/* --- style.css content starts --- */
body {
  font-family: Arial, sans-serif;
  line-height: 1.6;
  margin: 0;
  padding: 20px;
  background-color: #f4f4f9;
}

header {
  background: #333;
  color: white;
  padding: 10px 20px;
  margin-bottom: 20px;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

h1, h2 {
  color: #333;
}

.course-section, .course-quiz {
  background: white;
  padding: 20px;
  border-radius: 8px;
  box-shadow: 0 2px 4px rgba(0,0,0,0.1);
  margin-bottom: 20px;
}

.complete-btn {
  background: #007bff;
  color: white;
  border: none;
  padding: 10px 15px;
  border-radius: 5px;
  cursor: pointer;
  margin-top: 10px;
}

.complete-btn:hover {
  background: #0056b3;
}

.completed {
  color: green;
  font-weight: bold;
  margin-left: 10px;
}

.incomplete {
  color: orange;
  font-weight: bold;
  margin-left: 10px;
}

#quiz-result {
  margin-top: 15px;
  padding: 10px;
  border: 1px solid #ddd;
}
/* --- style.css content ends --- */
  </style>
</head>
<body>

  <header>
    <h1>{{COURSE_TITLE}}</h1>
    <div id="progress-display">Progress: 0%</div>
  </header>

  <main>
    <section id="section_1" class="course-section">
      <h2>1. Pengenalan</h2>
      <p>Ini adalah konten pertama Anda. Jelaskan dasar-dasar topik di sini.</p>
      <button onclick="markComplete('section_1')" class="complete-btn">Tandai Selesai: Section 1</button>
      <span class="status" id="status_section_1"></span>
    </section>
    
    <section id="section_2" class="course-section">
      <h2>2. Konsep Inti</h2>
      <p>Selami topik utama. Sertakan kode, gambar, atau contoh di sini.</p>
      <button onclick="markComplete('section_2')" class="complete-btn">Tandai Selesai: Section 2</button>
      <span class="status" id="status_section_2"></span>
    </section>

    <section id="section_3" class="course-section">
      <h2>3. Topik Lanjutan</h2>
      <p>Sediakan materi tambahan atau tips lanjutan untuk memperkaya pengetahuan siswa.</p>
      <button onclick="markComplete('section_3')" class="complete-btn">Tandai Selesai: Section 3</button>
      <span class="status" id="status_section_3"></span>
    </section>

    <section id="quiz_1" class="course-quiz">
      <h2>Quiz Akhir</h2>
      <div id="question-container">
        <p>1. Apa hasil dari 2 + 2?</p>
        <input type="radio" name="q1" value="3"> 3<br>
        <input type="radio" name="q1" value="4"> 4<br>
        <input type="radio" name="q1" value="5"> 5<br>
        <button onclick="submitCourseQuiz()">Kirim Jawaban</button>
      </div>
      <div id="quiz-result"></div>
    </section>
  </main>

  <script>
    // Metadata ini akan digunakan oleh script.js
    const COURSE_ID = '{{COURSE_ID}}';
    const COURSE_SECTIONS = ['section_1', 'section_2', 'section_3'];
    const COURSE_QUIZZES = ['quiz_1'];
    
    // Jawaban quiz (untuk keperluan contoh template)
    const QUIZ_ANSWERS = {
      'q1': '4'
    };
    
/* --- script.js content starts --- */
// Konfigurasi API
const API_URL = 'http://localhost:5000/api';
const TOKEN = localStorage.getItem('token');

// API Course untuk progress tracking
const courseAPI = {
  async markSectionComplete(sectionId) {
    if (!TOKEN) {
      alert('Silakan login untuk melacak progres');
      return;
    }
    
    try {
      const response = await fetch(`${API_URL}/progress/section`, {
        method: 'PUT',
        headers: {
          'Authorization': `Bearer ${TOKEN}`,
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({ 
          courseId: COURSE_ID, 
          sectionId 
        })
      });
      
      const data = await response.json();
      
      if (data.badgeEarned) {
        alert(`üéâ Lencana Diperoleh: ${data.badgeEarned.badgeName}`);
      }
      
      console.log('Section completed:', data);
      await updateProgressDisplay();
      return data;
    } catch (error) {
      console.error('Error marking section:', error);
    }
  },
  
  async submitQuiz(quizId, score) {
    if (!TOKEN) {
      alert('Silakan login untuk menyimpan hasil kuis');
      return;
    }
    
    try {
      const response = await fetch(`${API_URL}/progress/quiz`, {
        method: 'POST',
        headers: {
          'Authorization': `Bearer ${TOKEN}`,
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          courseId: COURSE_ID,
          quizId,
          score
        })
      });
      
      const data = await response.json();
      
      if (data.badgeEarned) {
        alert(`üéâ Lencana Diperoleh: ${data.badgeEarned.badgeName}`);
      }
      
      await updateProgressDisplay();
      return data;
    } catch (error) {
      console.error('Error submitting quiz:', error);
    }
  },
  
  async getProgress() {
    if (!TOKEN) return null;
    
    try {
      const response = await fetch(`${API_URL}/progress/course/${COURSE_ID}`, {
        headers: {
          'Authorization': `Bearer ${TOKEN}`
        }
      });
      
      if (response.ok) {
        return await response.json();
      }
      return null;
    } catch (error) {
      console.error('Error getting progress:', error);
      return null;
    }
  }
};

/**
 * Logika Course Client
 */

// Menghitung skor quiz sederhana
function calculateQuizScore() {
  let score = 0;
  
  // Mengambil jawaban dari form
  const q1_answer = document.querySelector('input[name="q1"]:checked')?.value;

  // Membandingkan dengan kunci jawaban
  if (q1_answer === QUIZ_ANSWERS['q1']) {
    score += 1;
  }
  
  return score;
}

// Handler untuk tombol "Tandai Selesai"
async function markComplete(sectionId) {
  const result = await courseAPI.markSectionComplete(sectionId);
  if (result) {
    document.getElementById(`status_${sectionId}`).textContent = '‚úÖ Selesai';
    document.getElementById(`status_${sectionId}`).classList.add('completed');
  }
}

// Handler untuk tombol "Kirim Jawaban Quiz"
async function submitCourseQuiz() {
  const score = calculateQuizScore();
  const quizId = COURSE_QUIZZES[0]; // Hanya ada 1 quiz: quiz_1
  
  const result = await courseAPI.submitQuiz(quizId, score);
  const resultDiv = document.getElementById('quiz-result');

  if (result) {
    resultDiv.innerHTML = `<strong>Hasil Anda: ${score} dari 1.</strong><br>`;
    if (result.isCompleted) {
      resultDiv.innerHTML += 'Kuis ini sudah selesai dan tersimpan.';
    } else {
      resultDiv.innerHTML += 'Gagal menyimpan hasil kuis.';
    }
  } else {
    resultDiv.innerHTML = 'Gagal mengirim hasil kuis.';
  }
}

// Update tampilan progres
async function updateProgressDisplay() {
  const progress = await courseAPI.getProgress();
  const display = document.getElementById('progress-display');
  
  if (!progress) {
    display.textContent = 'Progres: Login diperlukan';
    return;
  }
  
  // Hitung jumlah item (sections + quizzes)
  const totalItems = COURSE_SECTIONS.length + COURSE_QUIZZES.length; 
  
  // Hitung item yang sudah diselesaikan
  const sectionsDone = progress.completedSections.filter(s => COURSE_SECTIONS.includes(s)).length;
  const quizzesDone = progress.completedQuizzes.filter(q => COURSE_QUIZZES.includes(q)).length;
  const itemsDone = sectionsDone + quizzesDone;
  
  const percentage = totalItems > 0 ? Math.round((itemsDone / totalItems) * 100) : 0;
  
  display.textContent = `Progres: ${percentage}% (${itemsDone}/${totalItems} item)`;
  
  // Update status di setiap section
  COURSE_SECTIONS.forEach(sectionId => {
    const statusEl = document.getElementById(`status_${sectionId}`);
    if (statusEl) {
      if (progress.completedSections.includes(sectionId)) {
        statusEl.textContent = '‚úÖ Selesai';
        statusEl.classList.add('completed');
        statusEl.classList.remove('incomplete');
      } else {
        statusEl.textContent = '‚è≥ Belum Selesai';
        statusEl.classList.add('incomplete');
        statusEl.classList.remove('completed');
      }
    }
  });

  // Update status Quiz (sederhana)
  const quizResultDiv = document.getElementById('quiz-result');
  const quizId = COURSE_QUIZZES[0];
  if (progress.completedQuizzes.includes(quizId)) {
    quizResultDiv.innerHTML = '<strong>Kuis ini sudah selesai dan tersimpan di riwayat Anda.</strong>';
  }
}

// Inisialisasi: Tampilkan progres saat halaman dimuat
document.addEventListener('DOMContentLoaded', updateProgressDisplay);
/* --- script.js content ends --- */
  </script>
</body>
</html>